<!DOCTYPE html>
<html>
<head>
  <title>Random Character Generator</title>
  <link rel="stylesheet" type="text/css" href="/css/Styles.css">
</head>
<body>
  <h1>Gennerate Character</h1><br>
  <p><i>If you would like it to be random select: "Select Option"</i></p>
  <p>Please select your characters:</p>
  <ul>
    <li>Name:
      <input id="name" type="text" placeholder="Rick Astley" style="width: 75px; margin-left: 10px">
    </li> 
    <li>Level:
      <input id="lvl"type="number" min="1" max="1" value="1" style="width: 30px; margin-left: 10px">
    </li>
    <li>Class: 
      <select name="SelectClass" id="class" style="margin-left: 10px">
        <option value="random">Select Option</option>
        <option value="fighter">Fighter</option>
      </select>
    </li>
    <li>Sub-Class: 
      <select name="SelectClass" id="sClass" style="margin-left: 10px">
        <option value="random">Select Class</option>
      </select>
    </li>
    <li>Race: 
      <select name="SelectRace" id="race" style="margin-left: 10px" onchange="sRaceSet(this)">
        <option value="random">Select Option</option>
        <option value="human">Human</option>
        <option value="elf">Elf</option>
      </select>
    </li>
    <li>Sub-Race (if applicable):
      <select name="SelectSubRace" id="sRace" style="margin-left: 10px">
        <option value="random">Select a Race</option>
      </select>
    </li>
    <h2>Character:</h2>
    <button onclick="createCharacter()">Create</button>
  </ul>
  <div id="Character Output"></div>
  <script>
    function sRaceSet(r) {
      Race = r.value
      if(Race == "human") {
        document.getElementById("sRace").innerHTML= `
          <option value="random">Select Option</option>
          <option value="standard">Standard Human</option>
        `
      } else if(Race == "elf") {
        document.getElementById("sRace").innerHTML= `
          <option value="random">Select Option</option>
          <option value="wood">Wood Elf</option>
          <option value="high">High Elf</option>
          <option value="drow">Drow</option>
        `
      }
    }
    function createCharacter() {
      Char = {
        name: document.getElementById("name").value,
        lvl: document.getElementById("lvl").value,
        class: document.getElementById("class").value,
        subClass: document.getElementById("sClass").value,
        race: document.getElementById("race").value,
        subRace: document.getElementById("sRace").value
      }
      if(Char.class=="random") {
        n=Math.floor((Math.random() * (document.getElementById("class").length-1)) + 1);
      }
      vNum= Math.floor((Math.random() * 100) + 1);
      var abilityScores = [];
      for (let i = 0; i < 6; i++) {
        const rolls = Array.from({length: 4}, () => Math.floor(Math.random() * 6) + 1);
        rolls.sort((a, b) => a - b);
        const totalScore = rolls.slice(1).reduce((sum, roll) => sum + roll, 0);
        abilityScores.push(totalScore);
      }
      abilityScores.sort((a, b) =>a - b);
      abilityScores.reverse()
      Char.abilities = setAbilityPosition(abilityScores,Char,vNum)
      Char.abilityMod = setAbilityMod(Char)
      document.getElementById("Character Output").innerHTML= `
      <stat-block>
        <creature-heading>
          <h1>${Char.name}</h1>
          <h2>Medium humanoid</h2>
        </creature-heading>
        <top-stats>
          <property-line>
            <h4>Hit Points</h4>
            <p>${calcHP(Char)}</p>
          </property-line>
        <abilities-block 
        data-str="${Char.abilities[0]}"
        data-dex="${Char.abilities[1]}"
        data-con="${Char.abilities[2]}"
        data-int="${Char.abilities[3]}"
        data-wis="${Char.abilities[4]}"
        data-cha="${Char.abilities[5]}"></abilities-block>
      </stat-block>
      `
    }
    function setAbilityPosition(stats,c,num) {
      if(c.class=="fighter") {
        if(num<50) {
          orgArr=[0,2,1,5,4,3]
        } else {
          orgArr=[2,0,1,5,3,4]
        }
      }
      if(c.race=="human"){
        bonus=[1,1,1,1,1,1]
      } else if(c.race=='elf'){
        if(c.subRace=="high") {
          bonus=[0,2,0,1,0,0]
        } else if(c.subRace=="wood") {
          bonus=[0,2,0,0,1,0]
        } else if(c.subRace=="drow") {
          bonus=[0,2,0,0,0,1]
        }
      }
      finalStats=[]
      for(var i=0;i<6;i++){
        finalStats[i]= stats[orgArr[i]]+bonus[i]
      }
      return finalStats
    }
    function setAbilityMod(c) {
      modReturn=[]
      for(let i=0;i<6;i++) {
        modReturn[i] = Number((c.abilities[i]-10)/2)
      }
      return modReturn
    }

    function calcHP(c) {
      hpBonus=c.abilityMod[2]
      if(c.class=="wizard"||c.class=="sorcerer") {
        hitDie=6
      } else if(c.class=="rogue"||c.class=="warlock"||c.class=="cleric"
      ||c.class=="druid"||c.class=="artificer"||c.class=="bard"
      ||c.class=="monk") {
        hitDie=8
      } else if(c.class=="fighter"||c.class=="ranger"||c.class=="paladin") {
        hitDie=10
      } else if(c.class=="barbarian") {
        hitDie=12
      }
      if(c.lvl==1) {
        hp=hitDie+hpBonus
      }
    }
  </script>
</body>
</html>